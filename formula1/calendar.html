<!--29 - 28 - 28 - 28 - 29-->

<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ITW 2021/22 - Drivers List</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="css/myCSS.css" />
    <link rel="stylesheet" href="css/calendar.css" />


</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://logodownload.org/wp-content/uploads/2016/11/formula-1-logo-0.png" height=50></img>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="drivers.html">Drivers</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="constructors.html">Constructors</a></li>
                    <li class="nav-item"><a id="champion" class="nav-link" href="champions.html">Champions</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="calendar.html"><i
                                class="fa fa-calendar" title="Calendar"></i></a></li>
                    <li class="nav-item"><a class="nav-link" href="search.html"><i class="fa fa-search"
                                title="Selecione para procurar Condutores"></i></a></li>
                </ul>
            </div>
        </div>
    </nav>



    <div class="month">

        <button id="up" class=" fa fa-arrow-up" aria-hidden="true"></button>
        <button id="down" class=" fa fa-arrow-down" aria-hidden="true"></button>
        <ul>
            <li class="prev"><button id="left" class=" fa fa-arrow-left" aria-hidden="true"></button></li>
            <li class="next"><button id="right" class=" fa fa-arrow-right" aria-hidden="true"></button></li>

            <li><br><span id=mt style="font-size:10px"></span><span id=year style="font-size:18px"></span></li>
        </ul>
    </div>

    <ul class="weekdays">
        <li>Su</li>
        <li>Mo</li>
        <li>Tu</li>
        <li>We</li>
        <li>Th</li>
        <li>Fr</li>
        <li>Sa</li>
        
    </ul>

    <ul class="days">

    </ul>

    <ul class="list-group center" id="result"></ul>
    <br />






    <nav class="navbar navbar-dark bg-dark fixed-bottom">
        <div class="container small">
            <div class="navbar-text"></div>
            <div class="navbar-text">Made with <i class="fa fa-heart-o text-danger"></i> for U </div>
            <div class="navbar-nav">
                <div class="nav-item text-end"></div>
            </div>
        </div>
    </nav>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.js"
    integrity="sha512-2AL/VEauKkZqQU9BHgnv48OhXcJPx9vdzxN1JrKDVc4FPU/MEE/BZ6d9l0mP7VmvLsjtYwqiYQpDskK9dG8KBA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!---<script src ="flags.js"></script>--->
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.8.1/lottie.min.js"
    integrity="sha512-V1YyTKZJrzJNhcKthpNAaohFXBnu5K9j7Qiz6gv1knFuf13TW/3vpgVVhJu9fvbdW8lb5J6czIhD4fWK2iHKXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    function leapyear(year) {
        return (year % 100 === 0) ? (year % 400 === 0) : (year % 4 === 0);
    }

    function MonthInfo(month, b, yr) {
        var send;
        var numtxt;
        var nodays;
        var keyvalue;

        switch (month) {
            case 1:
                send = "January";
                numtxt = "01";
                nodays = 31;
                keyvalue = 1;
                break;

            case 2:

                send = "February";
                numtxt = "02";
                if (leapyear(yr)) {
                    nodays = 29;
                } else {
                    nodays = 28;
                }
                keyvalue=4;
                break;

            case 3:
                send = "March";
                numtxt = "03";
                nodays = 31;
                keyvalue = 4;
                break;
            case 4:
                send = "April";
                numtxt = "04";
                nodays = 30;
                keyvalue = 0;
                break;
            case 5:
                send = "May";
                numtxt = "05";
                nodays = 31;
                keyvalue=2;
                break;
            case 6:
                send = "June";
                numtxt = "06";
                nodays = 30;
                keyvalue = 5;
                break;
            case 7:
                send = "July";
                numtxt = "07";
                nodays = 31;
                keyvalue = 0;
                break;
            case 8:
                send = "August";
                numtxt = "08";
                nodays = 31;
                keyvalue = 3;
                break;
            case 9:
                send = "September";
                numtxt = "09";
                nodays = 30;
                keyvalue = 6;
                break;
            case 10:
                send = "October";
                numtxt = "10";
                nodays = 31;
                keyvalue = 1;
                break;
            case 11:
                send = "November";
                numtxt = "11";
                nodays = 30;
                keyvalue=4;
                break;
            case 12:
                send = "December";
                numtxt = "12";
                nodays = 31;
                keyvalue=6;
                break;

            default:
                console.log('error');
        }
        if (b == 1) { return numtxt; }
        else if (b == 2) { return send; }
        else if(b==3){ return nodays; }
        else{return keyvalue;}


    }
    function formula(yr,month) {
        var yrtxt= yr.toString(10);
        var yrtxtcropper = yrtxt.substring(yrtxt.length - 2);
        
        var finalyr= parseInt(yrtxtcropper);
        var d4 = Math.floor(finalyr/4);
        var addday = d4 + 1 ;
        var keyvalue = MonthInfo(month,4,yr);
        var step4 = addday + keyvalue;
        if((leapyear(yr)&&month==2)||month==1){
            step4--;
        }
        if(yr - 2000 >= 0){
            
            step4 = step4 + 6;
        }
        step4=step4+finalyr;
        console.log(step4);
        var remainder = (step4 % 7);
        console.log(remainder);
        return remainder;




        
        


    }
    


    var Year = 2021;
    var Month = 12;
    
    refreshPage();


    /*elementos dos botoes*/
    var addYear = $("#up");
    var subYear = $("#down");
    var subMonth = $("#left");
    var addMonth = $("#right");
    addYear.click(function () {
        Year++;
        refreshPage();
    });
    subYear.click(function () {
        Year--;
        refreshPage();
    });
    addMonth.click(function () {
        Month++;
        refreshPage();
    });
    subMonth.click(function () {
        Month--;
        refreshPage();
    });



    function refreshPage() {
        //reset values
        $("#down").show();
        $("#up").show();
        $("#right").show();
        $("#left").show();
        $('span.active').removeClass('active');
        $('#result').html('');
        $('.days').html('');

        ///////////////////////////////////

        var YearTxt = Year.toString(10);
        var MonthTxt = MonthInfo(Month, 2, Year);
        var numofDays = MonthInfo(Month, 3, Year);



        if (Year == 1950) {
            $("#down").hide();
        }
        if (Year == 2021) {
            $("#up").hide();
        }
        if (Month == 12) {
            $("#right").hide();
        }
        if (Month == 1) {
            $("#left").hide();
        }
        var baseuri = 'http://192.168.160.58/Formula1/api/Seasons/Season?year=';

        var composeduri = baseuri + YearTxt;
        var arrayActives = [];
        $.getJSON(composeduri, function (data) {

            var Races = data.Races;
            var date = "";


            $.each(Races, function (key, value) {
                date = value.Date;
                //[ , [ intervalo de  1950-05-13 1950-05-13
                var year = date.substring(0, 4);
                var month = date.substring(5, 7);
                var day = date.substring(8, 10);
                //var dayint = parseInt(day);
                var MonthStr = MonthInfo(Month, 1, Year);
                var raceId = data.RaceId;
                var numofDays = MonthInfo(Month, 3, Year);

                if (month == MonthStr) {
                    arrayActives.push(day);
                    
                    //$('#day' + day).addClass("active");
                    if (value.ImageUrl != null) {
                        $('#result').append('<a href="./raceDetails.html?id=' + value.RaceId + '"><li class="list-group-item link-class"><img src="' + value.ImageUrl + '" alt="" height="40" width="40" class="img-thumbnail" /> ' + value.Name + ' | <span class="text-muted">' + value.CircuitName + '(' + year + '-' + month + '-' + day + ')</span></li></a>');
                    }
                    else {
                        $('#result').append('<a href="./raceDetails.html?id=' + value.RaceId + '"><li class="list-group-item link-class">' + value.Name + ' | <span class="text-muted">' + value.CircuitName + '(' + year + '-' + month + '-' + day + ')</span></li></a>');
                    }
                    //$('#day' + day).attr("href", "http://127.0.0.1:5500/raceDetails.html?id=" + raceId);
                    //$('#day01').addClass("active");
                }




            });




            $("#mt").text(MonthTxt);
            $("#year").text(YearTxt);

        });
        //console.log(arrayActives);
        var w = formula(Year,Month);
        if(w == 0){
            w = 7;
        }
        for(let a=1;a<w;a++){
            $('.days').append('<li><span></span></li>');
        }
        for (let i = 1; i < numofDays + 1; i++) {
            
            
            var text = i.toString(10);
            if (i < 10) { text = "0" + text; }
            //console.log(text);
            $('.days').append('<li><span  id="day"' + text + '>' + text + '</span></li>');
            //arrayActives.includes(text)
            //console.log(text);
            //por alguma razao nao entra aqui
            if (arrayActives.includes(text)) {
                $('.days'+text).addClass('active');
                console.log("success");
            } 


        }
        

        //clear array
        while (arrayActives.length > 0) {
            a.pop();
        }

    }



</script>

</html>